<html lang="ko" layout:decorate="~{layout}" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<div layout:fragment="content" class="container my-3">
  <div class="container my-3">
    <h2 class="text-center">아티스트 목록</h2>
    <table class="table table-striped">
      <thead>
      <tr>
        <th scope="col">아티스트 한국 이름</th>
        <th scope="col">아티스트 영어 이름</th>
        <th scope="col">아티스트 이미지</th>
        <th scope="col">국적</th>
        <th scope="col">성별</th>
        <th scope="col">타입</th>
        <th scope="col">장르</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="artist : ${artists}">
        <td th:text="${artist.id}" hidden="hidden"></td>
        <td th:text="${artist.koreanName}"></td>
        <td th:text="${artist.englishName}"></td>
        <td>
          <img th:src="@{${artist.image}}" alt="아티스트 이미지" width="100">
        </td>
        <td th:text="${artist.country}"></td>
        <td>
          <div th:switch="${artist.artistGenderApiType.name()}">
            <span th:case="'MAN'" th:text="'남성'"></span>
            <span th:case="'WOMAN'" th:text="'여성'"></span>
          </div>
        </td>
        <td>
          <div th:switch="${artist.artistApiType.name()}">
            <span th:case="'SOLO'" th:text="'솔로'"></span>
            <span th:case="'GROUP'" th:text="'그룹'"></span>
          </div>
        </td>
        <td>
          <ul>
            <li th:each="genre : ${artist.genreNames}" th:text="${genre}"></li>
          </ul>
        </td>
        <td class="text-end">
          <form th:action="@{/admin/artists/{id}(id=${artist.id})}" method="get" style="display: inline-block;">
            <button type="submit" class="btn btn-primary">수정</button>
          </form>
          <form th:action="@{/admin/artists/{id}(id=${artist.id})}" method="post" style="display: inline-block;">
            <input type="hidden" name="_method" th:value="delete" />
            <button type="button" class="btn btn-danger" th:artistId="${artist.id}" onclick="deleteArtist(this.getAttribute('artistId'))">삭제</button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<script layout:fragment="script" type='text/javascript'>
  function deleteArtist(id) {
    if (confirm("정말 삭제하시겠습니까?")) {
      const form = document.createElement("form");
      form.method = "post";
      form.action = `/admin/artists/${id}`;
      const methodInput = document.createElement("input");
      methodInput.setAttribute("type", "hidden");
      methodInput.setAttribute("name", "_method");
      methodInput.setAttribute("value", "delete");
      form.appendChild(methodInput);
      document.body.appendChild(form);
      form.submit();
    } else {
      alert("삭제 취소");
    }
  }
</script>
</html>
